<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora de Risco ArrÃ­tmico â€“ DoenÃ§a de Chagas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:#f5f7fa;
  margin:0;
  color:#1f2933;
}
header{
  background:#0f172a;
  color:#fff;
  padding:30px;
  text-align:center;
  position:relative;
}
header h1{
  font-family:'Playfair Display',serif;
  margin-bottom:6px;
}
.lang-btn{
  position:absolute;
  top:20px;
  right:20px;
  background:#2563eb;
  border:none;
  color:#fff;
  padding:8px 12px;
  cursor:pointer;
}
main{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:40px 20px;
}
h2{
  margin-top:40px;
  border-bottom:2px solid #e5e7eb;
}
.box{
  background:#f1f5f9;
  border-left:5px solid #dc2626;
  padding:15px;
  margin:20px 0;
}
label{font-weight:600;display:block;margin-top:15px;}
small{color:#475569;font-size:13px;}
input{
  width:100%;
  padding:10px;
  font-size:16px;
}
button.calc{
  margin-top:20px;
  width:100%;
  padding:14px;
  background:#2563eb;
  color:#fff;
  border:none;
  font-size:16px;
  cursor:pointer;
}
.result{
  margin-top:25px;
  font-size:26px;
  font-weight:700;
}
.green{color:#15803d;} /* menor risco */
.red{color:#b91c1c;}   /* maior risco */

.chart{margin-top:25px;display:none;}
.bar{
  position:relative;
  height:18px;
  background:linear-gradient(
    to right,
    #bbf7d0 0%,
    #bbf7d0 39%,
    #fecaca 39%,
    #fecaca 100%
  );
  border-radius:6px;
}
.cutoff{
  position:absolute;
  left:39%;
  top:-6px;
  width:2px;
  height:30px;
  background:#dc2626;
}
.marker{
  position:absolute;
  top:-6px;
  width:12px;
  height:12px;
  border-radius:50%;
  transform:translateX(-50%);
}

.interpret{
  margin-top:20px;
  padding:15px;
  border-left:5px solid #2563eb;
  background:#f8fafc;
}

.report{
  margin-top:20px;
  padding:15px;
  border-left:5px solid #0f172a;
  background:#f8fafc;
}
.report p{
  font-size:14px;
  line-height:1.5;
  margin-top:10px;
  white-space:pre-line;
}

.ack{
  margin-top:20px;
  padding:15px;
  border-left:5px solid #0f172a;
  background:#f8fafc;
  font-style:italic;
}

footer{
  text-align:center;
  padding:20px;
  font-size:14px;
  color:#475569;
}
</style>
</head>

<body>

<header>
  <button class="lang-btn" onclick="toggleLang()">EN / PT</button>
  <h1 id="title"></h1>
  <p id="subtitle"></p>
</header>

<main>

<h2 id="h1"></h2>
<p id="desc"></p>

<div class="box" id="warn"></div>

<h2 id="h2"></h2>

<label id="lbl1"></label>
<small id="lbl1d"></small>
<input type="number" id="massa">

<label id="lbl2"></label>
<small id="lbl2d"></small>
<input type="number" id="disp">

<button class="calc" onclick="calc()" id="btn"></button>

<div class="result" id="result"></div>

<div class="chart" id="chart">
  <div class="bar">
    <div class="cutoff" title="Cutoff 0,39"></div>
    <div class="marker" id="marker"></div>
  </div>
</div>

<div class="interpret" id="interpret"></div>

<div class="report" id="reportBox" style="display:none;">
  <strong id="reportTitle"></strong>
  <p id="reportText"></p>
  <button class="calc" onclick="copyReport()" id="copyBtn"></button>
</div>

<h2 id="h3"></h2>
<p id="ref"></p>

<div class="ack" id="ack"></div>

</main>

<footer>Â© Ribeiro, L.C.M. â€“ FMUSP 2025</footer>

<script>
let lang="pt";

const T = {
  pt: {
    title: "Calculadora de Risco ArrÃ­tmico na DoenÃ§a de Chagas",
    subtitle: "Baseada em mecÃ¢nica miocÃ¡rdica por Speckle Tracking",
    h1: "O que Ã© esta calculadora?",
    desc:
      "Esta calculadora estima a probabilidade, pelo modelo de regressÃ£o logÃ­stica, de um paciente com DoenÃ§a de Chagas apresentar perfil semelhante ao de pacientes com CDI em prevenÃ§Ã£o secundÃ¡ria (substrato arritmogÃªnico).",
    warn:
      "âš ï¸ AplicÃ¡vel exclusivamente a pacientes com DoenÃ§a de Chagas. NÃ£o substitui julgamento clÃ­nico.",
    h2: "Calculadora",
    lbl1: "Massa do VentrÃ­culo Esquerdo (g)",
    lbl1d: "Massa absoluta, sem indexaÃ§Ã£o (mÃ©todo de Devereux).",
    lbl2: "DispersÃ£o MecÃ¢nica do VE (ms)",
    lbl2d: "Desvio padrÃ£o do tempo ao pico do strain longitudinal.",
    btn: "Calcular Risco",
    reportTitle: "Texto sugerido para laudo:",
    copyBtn: "Copiar texto para laudo",
    h3: "FundamentaÃ§Ã£o CientÃ­fica",
    ref:
      "Ribeiro, Luiz Carlos Madruga. MecÃ¢nica miocÃ¡rdica avaliada por Speckle Tracking como marcador prognÃ³stico na cardiomiopatia chagÃ¡sica. Tese (Doutorado) â€“ FMUSP, 2025. Orientadora: Profa. Dra. Ludhmila AbrahÃ£o Hajjar.",
    ack:
      "Agradecimentos: O autor agradece Ã  Dra. Adenalva Lima de Souza Beck e Ã  Profa. Dra. Ludhmila AbrahÃ£o Hajjar."
  },
  en: {
    title: "Arrhythmic Risk Calculator in Chagas Disease",
    subtitle: "Based on myocardial mechanics assessed by Speckle Tracking",
    h1: "What is this calculator?",
    desc:
      "This calculator estimates, using a logistic regression model, the probability that a patient with Chagas disease presents a profile similar to ICD recipients for secondary prevention (arrhythmogenic substrate).",
    warn:
      "âš ï¸ Intended exclusively for patients with Chagas disease. Not a substitute for clinical judgment.",
    h2: "Calculator",
    lbl1: "Left Ventricular Mass (g)",
    lbl1d: "Absolute LV mass, non-indexed (Devereux method).",
    lbl2: "Left Ventricular Mechanical Dispersion (ms)",
    lbl2d: "Standard deviation of time to peak longitudinal strain.",
    btn: "Calculate Risk",
    reportTitle: "Suggested report text:",
    copyBtn: "Copy report text",
    h3: "Scientific Background",
    ref:
      "Ribeiro, Luiz Carlos Madruga. Myocardial mechanics assessed by Speckle Tracking as a prognostic marker in Chagas cardiomyopathy. PhD Thesis â€“ FMUSP, 2025. Supervisor: Prof. Ludhmila AbrahÃ£o Hajjar.",
    ack:
      "Acknowledgements: The author thanks Dr. Adenalva Lima de Souza Beck and Prof. Ludhmila AbrahÃ£o Hajjar."
  }
};

function render(){
  document.documentElement.lang = (lang === "pt") ? "pt-BR" : "en";
  for (const k in T[lang]) {
    const el = document.getElementById(k);
    if (el) el.innerText = T[lang][k];
  }
}

function toggleLang(){
  lang = (lang === "pt") ? "en" : "pt";
  render();
  // se jÃ¡ tiver calculado, atualiza o texto de laudo no idioma atual
  const lastP = window.__lastP;
  if (typeof lastP === "number") updateReportText(lastP);
}

function calc(){
  const m = parseFloat(document.getElementById("massa").value);
  const d = parseFloat(document.getElementById("disp").value);
  if (isNaN(m) || isNaN(d)) return;

  const Z = -3.182 + 0.008 * m + 0.014 * d;
  const p = 1 / (1 + Math.exp(-Z));
  window.__lastP = p;

  const val = p.toFixed(2);
  const high = p >= 0.39;

  // ðŸ”´ alto risco (>=0,39) | ðŸŸ¢ menor risco (<0,39)
  document.getElementById("result").innerHTML =
    `${lang === "pt" ? "Probabilidade estimada pelo modelo" : "Model-estimated probability"}: 
     <span class="${high ? "red" : "green"}">${val}</span>`;

  document.getElementById("chart").style.display = "block";
  document.getElementById("marker").style.left = (p * 100) + "%";
  document.getElementById("marker").style.background = high ? "#b91c1c" : "#15803d";

  document.getElementById("interpret").innerText =
    (lang === "pt")
      ? (high
          ? "Perfil compatÃ­vel com substrato arritmogÃªnico (cutoff 0,39 â€“ sensibilidade 60,3%, especificidade 63,3%)."
          : "Perfil menos frequentemente associado a substrato arritmogÃªnico (cutoff 0,39).")
      : (high
          ? "Profile compatible with an arrhythmogenic substrate (cutoff 0.39 â€“ sensitivity 60.3%, specificity 63.3%)."
          : "Profile less frequently associated with an arrhythmogenic substrate (cutoff 0.39).");

  updateReportText(p);
}

function updateReportText(p){
  const value = p.toFixed(2);
  const high = p >= 0.39;

  if (lang === "pt") {
    document.getElementById("reportText").innerText =
`Realizado cÃ¡lculo de risco arrÃ­tmico por regressÃ£o logÃ­stica (probabilidade ${value}).
${high ? "Perfil compatÃ­vel com substrato arritmogÃªnico." : "Perfil menos frequentemente associado a substrato arritmogÃªnico (cutoff 0,39)."}
Modelo com sensibilidade de 60,3% e especificidade de 63,3%.
Conforme Ribeiro, Luiz Carlos Madruga. MecÃ¢nica miocÃ¡rdica avaliada por Speckle Tracking como marcador prognÃ³stico na cardiomiopatia chagÃ¡sica. Tese de Doutorado â€“ FMUSP, 2025.`;
  } else {
    document.getElementById("reportText").innerText =
`Arrhythmic risk estimated by logistic regression (probability ${value}).
${high ? "Profile compatible with an arrhythmogenic substrate." : "Profile less frequently associated with an arrhythmogenic substrate (cutoff 0.39)."}
Model sensitivity 60.3% and specificity 63.3%.
According to Ribeiro, Luiz Carlos Madruga. Myocardial mechanics assessed by Speckle Tracking as a prognostic marker in Chagas cardiomyopathy. PhD Thesis â€“ FMUSP, 2025.`;
  }

  document.getElementById("reportBox").style.display = "block";
}

function copyReport(){
  navigator.clipboard.writeText(document.getElementById("reportText").innerText)
    .then(() => alert(lang === "pt" ? "Texto copiado para a Ã¡rea de transferÃªncia." : "Copied to clipboard."));
}

render();
</script>

</body>
</html>
